<div class="content">
    <div class="page-header">
        <div class="add-item d-flex">
            <div class="page-title">
                <h4>{{ isNew ? 'Thêm Tài Liệu Mới' : 'Chỉnh Sửa Tài Liệu' }}</h4>
                <h6>{{ isNew ? 'Tạo tài liệu mới' : 'Cập nhật thông tin tài liệu' }}</h6>
            </div>
        </div>
        <div class="page-btn">
            <a routerLink="/resources" class="btn btn-secondary">
                <i data-feather="arrow-left" class="me-2"></i>Quay lại
            </a>
        </div>
    </div>

    <form (ngSubmit)="onSubmit()" #resourceForm="ngForm">
        <div class="card">
            <div class="card-body">
                <!-- Thông tin cơ bản -->
                <div class="new-employee-field">
                    <div class="card-title-head">
                        <h6><span><i data-feather="info" class="feather-edit"></i></span>Thông Tin Cơ Bản</h6>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-sm-6 col-12">
                            <div class="mb-3">
                                <label class="form-label">Tiêu Đề <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" [(ngModel)]="form.title" name="title" required>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-sm-6 col-12">
                            <div class="mb-3">
                                <label class="form-label">Chủ Đề</label>
                                <select class="form-control" [(ngModel)]="form.topic_id" name="topic_id">
                                    <option [value]="1">Toán học</option>
                                    <option [value]="2">Văn học</option>
                                    <option [value]="3">Khoa học</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-3 col-sm-6 col-12">
                            <div class="mb-3">
                                <label class="form-label">Loại Tài Liệu</label>
                                <select class="form-control" [(ngModel)]="form.type_id" name="type_id" (change)="onTypeChange()">
                                    <option [value]="1">PDF</option>
                                    <option [value]="2">Video</option>
                                    <option [value]="3">Hình ảnh</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label">Mô Tả</label>
                                <textarea class="form-control" rows="4" [(ngModel)]="form.description" name="description"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6 col-sm-6 col-12">
                            <div class="mb-3">
                                <label class="form-label">Trạng Thái</label>
                                <select class="form-control" [(ngModel)]="form.status_id" name="status_id">
                                    <option [value]="1">Chờ duyệt</option>
                                    <option [value]="2">Đã duyệt</option>
                                    <option [value]="3">Từ chối</option>
                                    <option [value]="4">Đã xóa</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-lg-6 col-sm-6 col-12">
                            <div class="mb-3">
                                <label class="form-label">YouTube URL</label>
                                <input type="url" class="form-control" [(ngModel)]="form.youtube_url" name="youtube_url" placeholder="https://youtube.com/watch?v=...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- File Upload -->
                <div class="new-employee-field">
                    <div class="card-title-head">
                        <h6><span><i data-feather="upload" class="feather-edit"></i></span>Tải File Lên</h6>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label">Chọn File</label>
                                <input #fileInput type="file" class="form-control" (change)="handleFileSelected($event)" [accept]="getAcceptedFileTypes()">
                            </div>
                        </div>
                    </div>

                    <div class="row" *ngIf="form.original_file_name">
                        <div class="col-lg-12">
                            <div class="alert alert-info">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <strong>File đã chọn:</strong> {{ form.original_file_name }}
                                        <br>
                                        <small>Kích thước: {{ formatFileSize(form.file_size || 0) }}</small>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-danger" (click)="clearFile()">
                                        <i data-feather="x"></i> Xóa
                                    </button>
                                </div>
                                
                                <!-- Preview File -->
                                <div class="file-preview mt-3" *ngIf="filePreviewUrl">
                                    <div class="preview-container">
                                        <!-- Preview cho hình ảnh -->
                                        <div *ngIf="isImageFile()" class="text-center">
                                            <img [src]="filePreviewUrl" alt="Preview" class="img-thumbnail" style="max-width: 400px; max-height: 400px;">
                                        </div>
                                        
                                        <!-- Preview cho video -->
                                        <div *ngIf="isVideoFile()" class="text-center">
                                            <video controls class="img-thumbnail" style="max-width: 600px; max-height: 400px;">
                                                <source [src]="filePreviewUrl" [type]="getFileType()">
                                                Trình duyệt không hỗ trợ video.
                                            </video>
                                        </div>
                                        
                                        <!-- Preview cho PDF -->
                                        <div *ngIf="isPdfFile()" class="text-center">
                                            <iframe [src]="filePreviewUrl" style="width: 100%; height: 500px; border: 1px solid #ddd;"></iframe>
                                        </div>
                                        
                                        <!-- Preview cho Office files (Word, Excel, PowerPoint) -->
                                        <div *ngIf="isOfficeFile()" class="text-center">
                                            <div class="alert alert-warning mb-3">
                                                <i data-feather="info" class="feather-16"></i>
                                                Preview file Office sẽ khả dụng sau khi upload lên server
                                            </div>
                                            <div class="office-file-icon text-center py-4">
                                                <i [attr.data-feather]="getOfficeIcon()" class="feather-48"></i>
                                                <p class="mt-2 fw-bold">{{ getFileTypeName() }}</p>
                                                <p class="text-muted">{{ form.original_file_name }}</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Icon cho các file khác -->
                                        <div *ngIf="!isImageFile() && !isVideoFile() && !isPdfFile() && !isOfficeFile()" class="text-center py-4">
                                            <i data-feather="file" class="feather-48"></i>
                                            <p class="mt-2">{{ getFileTypeName() }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="btn-path">
                            <button type="button" class="btn btn-cancel me-2" routerLink="/resources">Hủy</button>
                            <button type="submit" class="btn btn-primary" [disabled]="!resourceForm.valid">
                                {{ isNew ? 'Thêm Tài Liệu' : 'Cập Nhật' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
