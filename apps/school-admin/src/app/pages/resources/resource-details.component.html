<div class="content" *ngIf="resource">
    <div class="page-header">
        <div class="add-item d-flex">
            <div class="page-title">
                <h4>Chi Tiết Tài Liệu</h4>
                <h6>Xem thông tin đầy đủ về tài liệu</h6>
            </div>
        </div>
        <div class="page-btn">
            <a routerLink="/resources" class="btn btn-secondary d-flex align-items-center">
                <i data-feather="arrow-left" class="me-2"></i>Quay Lại
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Thông tin chi tiết -->
        <div class="col-lg-8 col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="new-employee-field">
                        <div class="card-title-head">
                            <h6><span><i data-feather="info" class="feather-edit"></i></span>Thông Tin Chi Tiết</h6>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">ID</label>
                                    <p class="form-control-static">{{ resource.id }}</p>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Tiêu Đề</label>
                                    <p class="form-control-static fw-bold">{{ resource.title }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Chủ Đề</label>
                                    <p class="form-control-static">{{ resourceService.topicName(resource.topic_id) }}</p>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Loại Tài Liệu</label>
                                    <p class="form-control-static">{{ resourceService.typeName(resource.type_id) }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <label class="form-label">Mô Tả</label>
                                    <p class="form-control-static">{{ resource.description || 'Không có mô tả' }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Trạng Thái</label>
                                    <p class="form-control-static">
                                        <span class="badge" [ngClass]="{
                                            'badge-success': resource.status_id === 2,
                                            'badge-danger': resource.status_id === 3,
                                            'badge-bgdanger': resource.status_id === 4,
                                            'badge-warning': resource.status_id === 1
                                        }">
                                            {{ resourceService.statusMeta(resource.status_id)?.label }}
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Người Tải Lên</label>
                                    <p class="form-control-static">User ID: {{ resource.uploader_id }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Ngày Tải Lên</label>
                                    <p class="form-control-static">{{ resource.created_at | date:'dd/MM/yyyy HH:mm' }}</p>
                                </div>
                            </div>
                            <div class="col-lg-6" *ngIf="resource.approved_at">
                                <div class="mb-3">
                                    <label class="form-label">Ngày Duyệt</label>
                                    <p class="form-control-static">{{ resource.approved_at | date:'dd/MM/yyyy HH:mm' }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row" *ngIf="resource.approver_id">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Người Duyệt</label>
                                    <p class="form-control-static">User ID: {{ resource.approver_id }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="row" *ngIf="resource.youtube_url">
                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <label class="form-label">YouTube URL</label>
                                    <p class="form-control-static">
                                        <a [href]="resource.youtube_url" target="_blank">{{ resource.youtube_url }}</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <div class="btn-path d-flex gap-2">
                                <a [routerLink]="['/resources/edit', resource.id]" class="btn btn-primary d-flex align-items-center">
                                    <i data-feather="edit" class="me-2"></i>Chỉnh Sửa
                                </a>
                                <button type="button" class="btn btn-danger d-flex align-items-center" (click)="showDeleteModal()">
                                    <i data-feather="trash-2" class="me-2"></i>Xóa
                                </button>
                                <a routerLink="/resources" class="btn btn-secondary d-flex align-items-center ms-auto">
                                    <i data-feather="list" class="me-2"></i>Danh Sách
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview và File -->
        <div class="col-lg-4 col-sm-12">
            <!-- File Info -->
            <div class="card" *ngIf="resource.file_path">
                <div class="card-body">
                    <div class="new-employee-field">
                        <div class="card-title-head">
                            <h6><span><i data-feather="file" class="feather-edit"></i></span>File Đính Kèm</h6>
                        </div>
                        <div class="mb-3">
                            <p><strong>Tên file:</strong> {{ resource.original_file_name }}</p>
                            <p><strong>Kích thước:</strong> {{ formatFileSize(resource.file_size || 0) }}</p>
                            <a [href]="resource.file_path" target="_blank" class="btn btn-primary btn-sm d-inline-flex align-items-center">
                                <i data-feather="download" class="me-2"></i>Tải Xuống
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <div class="card-body">
                    <div class="new-employee-field">
                        <div class="card-title-head">
                            <h6><span><i data-feather="eye" class="feather-edit"></i></span>Xem Trước</h6>
                        </div>
                        
                        <!-- YouTube Preview -->
                        <div *ngIf="resource.youtube_url" class="mb-3">
                            <div class="ratio ratio-16x9">
                                <iframe [src]="getYouTubeEmbedUrl(resource.youtube_url)" 
                                        allowfullscreen
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                                </iframe>
                            </div>
                        </div>

                        <!-- File Preview -->
                        <div *ngIf="resource.file_path && !resource.youtube_url">
                            <!-- Image Preview -->
                            <div *ngIf="isImageFile()" class="text-center mb-3">
                                <img [src]="resource.file_path" alt="Preview" class="img-fluid img-thumbnail" style="max-height: 400px;">
                            </div>

                            <!-- PDF Preview -->
                            <div *ngIf="isPdfFile()" class="mb-3">
                                <iframe [src]="getSafeUrl(resource.file_path)" style="width: 100%; height: 500px; border: 1px solid #ddd;"></iframe>
                            </div>

                            <!-- Video Preview -->
                            <div *ngIf="isVideoFile()" class="mb-3">
                                <video controls class="w-100" style="max-height: 400px;">
                                    <source [src]="resource.file_path">
                                    Trình duyệt không hỗ trợ video.
                                </video>
                            </div>

                            <!-- Other Files -->
                            <div *ngIf="!isImageFile() && !isPdfFile() && !isVideoFile()" class="text-center py-4">
                                <i data-feather="file" class="feather-48 mb-3"></i>
                                <p>Không có xem trước cho loại file này</p>
                                <p class="text-muted">{{ getFileExtension() }}</p>
                            </div>
                        </div>

                        <div *ngIf="!resource.file_path && !resource.youtube_url" class="text-center py-4">
                            <i data-feather="alert-circle" class="feather-48 mb-3"></i>
                            <p class="text-muted">Không có file hoặc video để xem trước</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="delete-modal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Xác Nhận Xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa tài liệu <strong>"{{ resource?.title }}"</strong> không?</p>
                <p class="text-danger"><small>Hành động này không thể hoàn tác!</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
</div>
